name: Issue Trigger PoC

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  poc:
    runs-on: ubuntu-latest

    steps:
      - name: Show issue info
        run: |
          echo "TITLE:"
          echo "${{ github.event.issue.title }}"
          echo "BODY:"
          echo "${{ github.event.issue.body }}"

      - name: Execute harmless command
        run: |
          id

      - name: Comment back on issue
        env:
          TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OWNER: ${{ github.repository_owner }}
          REPO: ${{ github.event.repository.name }}
          ISSUE: ${{ github.event.issue.number }}
        run: |
          set -e
          BODY="⚠️ PoC executed by GitHub Actions"
          JSON=$(printf '{"body":"%s"}' "$BODY")

          curl -s -X POST \
            -H "Authorization: Bearer $TOKEN" \
            -H "Content-Type: application/json" \
            "https://api.github.com/repos/$OWNER/$REPO/issues/$ISSUE/comments" \
            -d "$JSON"
